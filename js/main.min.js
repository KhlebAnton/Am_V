function sliderMain() {
    new Swiper(".main .mySwiper",{
        slidesPerView: 1,
        spaceBetween: 10,
        navigation: {
            nextEl: ".main .swiper-button-next",
            prevEl: ".main .swiper-button-prev",
        },
    })
}

function sliderProduction() {
    new Swiper(".production .mySwiper",{
        slidesPerView: 1,
        spaceBetween: 0,
        breakpoints: {
            320: {
                slidesPerView: 1.1,
                spaceBetween: 24,
            },
            577: {
                slidesPerView: 1.5,
                spaceBetween: 24,
            },
            993: {
                slidesPerView: 1,
                spaceBetween: 0,
            }
        }
    })
}

function gallery() {
    var swiper = new Swiper(".gallery .mySwiper", {
        slidesPerView: 4,
        spaceBetween: 6,
        freeMode: true,
        watchSlidesProgress: true,
        direction: "vertical",
        breakpoints: {
            320: {
                spaceBetween: 4,
                direction: "horizontal"
            },
            993: {
                spaceBetween: 4,
                direction: "vertical"
            }
        }
    });
    var swiper2 = new Swiper(".gallery .mySwiper2", {
        spaceBetween: 6,
        slidesPerView: 1,
        thumbs: {
            swiper: swiper,
        },
    });
}

function sliderProductMain() {
    new Swiper(".product-main__tabs .mySwiper",{
        slidesPerView: 3,
        spaceBetween: 10,
        slideToClickedSlide: "true",
        breakpoints: {
            320: {
                slidesPerView: "auto",
                spaceBetween: 6,
            },
            577: {
                slidesPerView: 3,
                spaceBetween: 10,
            }
        }
    })
}

function sliderRoute() {
    new Swiper(".route .mySwiper",{
        slidesPerView: 3,
        spaceBetween: 8,
        slideToClickedSlide: "true",
        breakpoints: {
            320: {
                slidesPerView: "auto",
            },
            993: {
                slidesPerView: 3,
            }
        }
    })
}

let SlidersArray = []
function sliderServices() {
    $(".slider").each(function(index, el) {
        $(el).attr("data-slider-id", `${index}`)
        SlidersArray[index] = new Swiper(`.slider[data-slider-id="${index}"] .swiper`, {
            slidesPerView: 2,
            spaceBetween: 25,
            observer: true,
            observeParents: true,
            grid: {
                rows: 2,
            },
            navigation: {
                nextEl: `.slider[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.slider[data-slider-id="${index}"] .swiper-button-prev`,
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    spaceBetween: 15,
                    grid: {
                        rows: 1,
                    },
                },
                360: {
                    slidesPerView: 2,
                    spaceBetween: 25,
                    grid: {
                        rows: 1,
                    },
                },
                768: {
                    slidesPerView: 2,
                    spaceBetween: 25,
                    grid: {
                        rows: 2,
                    },
                }
            }
        })
    })
}

let SlidersArray2 = []
function sliderServices2() {
    $(".slider2").each(function(index, el) {
        $(el).attr("data-slider-id", `${index}`)
        SlidersArray2[index] = new Swiper(`.slider2[data-slider-id="${index}"] .swiper`, {
            slidesPerView: 2,
            spaceBetween: 25,
            observer: true,
            observeParents: true,
            grid: {
                rows: 2,
            },
            navigation: {
                nextEl: `.slider2[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.slider2[data-slider-id="${index}"] .swiper-button-prev`,
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                    spaceBetween: 15,
                    grid: {
                        rows: 1,
                    },
                },
                451: {
                    slidesPerView: 2,
                    spaceBetween: 25,
                    grid: {
                        rows: 1,
                    },
                },
                768: {
                    slidesPerView: 2,
                    spaceBetween: 25,
                    grid: {
                        rows: 2,
                    },
                }
            }
        })
    })
}

function sliderServicesBtns() {
    new Swiper(".services__btns .mySwiper",{
        slidesPerView: 2,
        spaceBetween: 16,
        slideToClickedSlide: "true",
        breakpoints: {
            320: {
                slidesPerView: "auto",
            },
            577: {
                slidesPerView: 2,
            }
        }
    })
}

function sliderModalPrice() {
    new Swiper(".services__btns .mySwiper",{
        slidesPerView: 2,
        spaceBetween: 16,
        slideToClickedSlide: "true",
        breakpoints: {
            320: {
                slidesPerView: "auto",
            },
            799: {
                slidesPerView: 2,
            }
        }
    })
}


$(document).ready(function () {
    sliderMain();
    sliderProduction();
    gallery();
    sliderProductMain();
    sliderRoute();
    sliderServices();
    sliderServices2();
    sliderServicesBtns();
    sliderModalPrice();

// Search
    $('.search__show input').on('input', function() {
        if ($(this).val().trim() !== '') {
            $(this).parents('.search').addClass('search--active');
        } else {
            $(this).parents('.search').removeClass('search--active');
        }
    });

    // Menu
    $('.menu-item__show').click(function (event) {
        event.stopPropagation();
        $(this).toggleClass('menu-item__show--active');
        $(this).siblings('.menu-item__hidden').toggleClass('menu-item__hidden--active');
    });

    $('.menu-subitem').click(function () {
        $(this).siblings('.menu-subitem').removeClass('menu-subitem--active')
        $(this).toggleClass('menu-subitem--active')
    })

    $(document).click(function (event) {
        if (!$(event.target).closest('.menu-item__show, .menu-item__hidden').length) {
            $('.menu-item__show').removeClass('menu-item__show--active');
            $('.menu-item__hidden').removeClass('menu-item__hidden--active');
        }
    });

    $('.burger').click(function () {
        $('.header-mob').addClass('header-mob--active')
        $('body').addClass('fixed-body')
    })

    $('.header-mob__close').click(function () {
        $('.header-mob').removeClass('header-mob--active')
        $('body').removeClass('fixed-body')
    })

    // Favorite
    $('.favorite').click(function () {
        $(this).toggleClass('favorite--active')
    })

    // Accordion
    $(".item-show").click(function () {
        let parent = $(this).parents(".item")
        if($(parent).hasClass("item--active")){
            $(".item").removeClass("item--active")
            $(".item-hidden").slideUp()
        }else{
            $(".item").removeClass("item--active")
            $(parent).addClass("item--active")
            $(".item-hidden").slideUp()
            $(this).siblings(".item-hidden").slideDown()
        }
    })

    // Show - Hidden
    $('.show-all').click(function () {
        $(this).toggleClass('show-all--active')
        $(this).siblings('.hidden-content').toggleClass('hidden-content--active')
    })

    // PhoneMask
    $('.phoneNumber').inputmask("+7 (999) 999-9999");

    // Form - btn
    $('.connection__form-btn').on('click', function(event) {
        event.preventDefault();
    });

    // Calc
    function cartCalc(){
        $('.cartcalc .ccalc-minus').click(function(){
            let a = $(this).closest('.cartcalc').find('input').val();
            if(a>1){
                let b = +a-1;
                $(this).closest('.cartcalc').find('input').val(b);
            }else{
                $(this).closest('.cartcalc').find('input').val(a);
            }
        });
        $('.cartcalc .ccalc-plus').click(function(){
            let a = $(this).closest('.cartcalc').find('input').val();
            let b = +a+1;
            $(this).closest('.cartcalc').find('input').val(b);
        });
    }
    cartCalc()

    // Tabs
    $(".tab").click(function () {
        let path = $(this).attr("data-tab-path");
        $(this).siblings(".tab").removeClass("tab--active");
        $(this).addClass("tab--active");

        $(this).parents(".tabs").find(".tab__content").removeClass("tab__content--active");
        $(this).parents(".tabs").find(`.tab__content[data-content-path="${path}"]`).addClass("tab__content--active");
    });

    // Select
    $('.select-head').click(function () {
        $(this).parent('.select').toggleClass('select--active')
    })

    $('.select-body .select-li').click(function () {
        var currentele = $(this).html()
        $(this).parents('.select').find('.select-current').html(currentele)
        $(this).parents('.select').removeClass('select--active')
        $(this).siblings(".select-body .select-li").removeClass("select-li--active")
        $(this).addClass("select-li--active")
    })

    let selectBody = $('.select-body .select-li')
    let select = $('.select')

    $(document).click(function (e) {
        if ( !selectBody.is(e.target) && selectBody.has(e.target).length === 0 &&
            !select.is(e.target) && select.has(e.target).length === 0

        ) {
            select.removeClass('select--active')
        }
    })

    // Modal
    $("[data-modal]").click(function () {
        let modalId = $(this).attr("data-modal")

        openModal(modalId)
    })

    function openModal(modalId){
        $(`#${modalId}`).addClass("modal--active")
        $("body").addClass("fixed-body")
    }

    $(".modal").click(function () {
        closeModal()
    })

    $("._close-modal").click(function () {
        closeModal()
    })

    $(".modal__dialog").click(function (e) {
        e.stopPropagation()
    })


    function closeModal() {
        $('.modal').removeClass("modal--active")
        $("body").removeClass("fixed-body")
    }

})

// Filter
$('.filter-btn').click(function () {
    $('.catalog__left').addClass('catalog__left--active')
    $('body').addClass('fixed-body')
})

$('.filter-close').click(function () {
    $('.catalog__left').removeClass('catalog__left--active')
    $('body').removeClass('fixed-body')
})

// NoUiSlider
document.addEventListener('DOMContentLoaded', function () {
    function initSlider(sliderId, minInputId, maxInputId, minValue, maxValue) {
        var slider = document.getElementById(sliderId);
        var minInput = document.getElementById(minInputId);
        var maxInput = document.getElementById(maxInputId);

        noUiSlider.create(slider, {
            start: [minValue, maxValue],
            connect: true,
            range: {
                'min': minValue,
                'max': maxValue
            }
        });

        slider.noUiSlider.on('update', function (values, handle) {
            if (handle === 0) {
                minInput.value = Math.round(values[0]);
            } else {
                maxInput.value = Math.round(values[1]);
            }
        });

        minInput.addEventListener('change', function () {
            slider.noUiSlider.set([this.value, null]);
        });

        maxInput.addEventListener('change', function () {
            slider.noUiSlider.set([null, this.value]);
        });
    }

    initSlider('slider1', 'value1-min', 'value1-max', 0, 254000);
    initSlider('slider2', 'value2-min', 'value2-max', 0, 300000);
    initSlider('slider3', 'value3-min', 'value3-max', 0, 400000);
    initSlider('slider4', 'value4-min', 'value4-max', 0, 500000);
});